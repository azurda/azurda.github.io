<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<style type=text/css>body{font-family:monospace;}</style>
	<title>Frida Tools</title>
	
	
	<link rel="stylesheet" href="/css/style.css">
	
	
</head>
<body>
	<header>
	============<br>
	== <a href="https://azurda.github.io/">azurda</a> ==<br>
	============
	<div style="float: right;">Blog about reverse engineering, game hacking and frida.</div><br>
	<p>
	<nav>
			<a href="/"><b>Start</b></a>.
			
			
			<a href="/categories/"><b>Categories</b></a>.
			
			<a href="/tags/"><b>Tags</b></a>.
			
	</nav>
	</p>
	
</header>

	
	<main>
		<article>
			<h1>Frida Tools</h1>
			<b><time>2020-12-22 23:10:36</time></b>
		       

			<div>
				<p>The <code>frida-tools</code> package offers some CLI tools that we can use for quick binary instrumentation. We can install them by simply running the following command:</p>
<p><code>pip install frida-tools</code></p>
<p>We are going to take a look at the most important tools: <code>frida CLI</code> and <code>frida-trace</code></p>
<h1 id="frida-trace">frida-trace</h1>
<p>This tool alllows us to instrument processes or apps without the need of writing an instrumentation tool. This tool&rsquo;s funtionality is based on the <code>Interceptor</code> API:</p>
<ul>
<li>Instrument running processes or spawn new ones.</li>
<li>Follow child processes</li>
<li>Instrument whole libraries: <code>KERNEL32.DLL!*</code> or <code>NTDLL.DLL!*</code></li>
<li>Instrument specific APIs such as <code>KERNEL32.DLL!CreateFileW</code></li>
<li>Allows for different ways of working: Via USB (for mobile devices), local and remote.</li>
</ul>
<h2 id="basic-usage">Basic usage</h2>
<p>We have different options when instrumenting processes or binaries in Linux / MacOS / Windows systems:</p>
<ul>
<li><code>$ frida trace -f binary.exe</code>: The -f parameter is used to spawn a new process given a binary or a path to the binary we want to instrument.</li>
<li><code>$ fritda-trace &lt;PID|process_name&gt;</code>: We can instrument an already running process given it&rsquo;s PID or process name. <strong>It&rsquo;s important to know that if two processes share the same process name, frida-trace won&rsquo;t attach to either of them</strong>.</li>
</ul>
<p>We can also select between the duktape runtime and the JSV8 runtime with the <code>--runtime</code> flag:</p>
<p><code>$ frida-trace -runtime=duk 1234</code></p>
<p><strong>Note</strong>: <code>frida-trace</code>'s parameters are case sensitive so we need to take this into account when using the tool. For example, lowercase parameters are used for functions <em>inclusions</em> and exclusiones hwereas <em>uppercase</em> parameters will be used for modules.</p>
<h2 id="function-tracing">Function tracing</h2>
<p>We can trace specific functions thanks to the <code>-i</code> parameter. It&rsquo;s also possible to use the <code>*</code> wildcard to match any function that contains the desired string. It&rsquo;s also possible to specify from which modules we want the function to come from with the <code>-I</code> parameter whereas <code>-X</code> parameter is used for module exclusions.</p>
<p><code>-I</code> and <code>-X</code> only include module EXPORTS, for module IMPORTS use the <code>-T</code> parameter.</p>
<ul>
<li>
<p><code>$ frida-trace -i &quot;CreateFileW&quot;</code>: Instruments every API call that matches the exact string, without taking into account what module comes from.</p>
</li>
<li>
<p><code>$ frida-trace -i &quot;CreateFileW*</code>: Due to the <code>*</code>, it will match any API call from every module that starts with the string <code>CreateFileW</code>.</p>
</li>
<li>
<p><code>$ frida-trace -i &quot;CreateFileW&quot; -I &quot;KERNEL32.dll</code>: Matches the <code>CreateFileW</code> API from the <code>KERNEL32</code> module.</p>
</li>
<li>
<p><code>$ frida-trace -i &quot;CreateFileW&quot; -X &quot;KERNEL32.dll</code>: Matches the <code>CreateFileW</code> API <em>that are not</em> from the <code>KERNEL32</code> module.</p>
</li>
</ul>
<p>We can repeatedly use these operators to exclude and include multiple functions or modules. Instrumenting calls given <strong>module offsets</strong>  is also possible thanks to the <code>-a</code> parameter:</p>
<p><code>frida-trace PID -a &quot;customLib.DLL!localPrint&quot;</code></p>
<h3 id="interesting-modifiers">Interesting modifiers</h3>
<p>These modifiers are worth remembering:</p>
<ul>
<li><code>-q</code>: remove <code>FRIDA</code>'s API call formatting for each instrumented call.</li>
<li><code>--runtime=duktape/v8</code>: Choose the desired runtime. <code>duktape</code> is recommended for <code>performance</code> and <code>v8</code> recommended for modern JS/TS features and a more in-depth error reporting.</li>
<li><code>--debug</code>: Opens <code>FRIDA</code>'s debug console</li>
</ul>

			</div>
		</article>
	</main>
<aside>
	<div>
		<div>
			<h3>LATEST POSTS</h3>
		</div>
		<div>
			<ul>
				
				<li><a href="/posts/searchpathw/">SearchPathW hook &#43; example code.</a></li>
				
				<li><a href="/posts/frida-tools/">Frida Tools</a></li>
				
				<li><a href="/posts/structs/">Reading structs with Frida</a></li>
				
			</ul>
		</div>
	</div>
</aside>


	<footer>
	<p>&copy; 2021 <a href="https://azurda.github.io/"><b>azurda</b></a>.
	<a href="https://github.com/azurda"><b>Github</b></a>.
	<a href="https://twitter.com/entdark_"><b>Twitter</b></a>.
	<a href="#ZgotmplZ"><b>frida IRC</b></a>.
	</p>
</footer>

</body>
</html>
